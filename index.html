<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ä¸‹ä¸€ç«™å»å“ªï¼ŸTravel Randomizer 3D</title>
    <script src="//unpkg.com/globe.gl"></script>
    <style>
        body {
            font-family: 'Helvetica Neue', Arial, sans-serif;
            background: #0a0a0a; 
            margin: 0;
            color: #fff; 
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center; 
            height: 100vh; 
            overflow: hidden; 
            position: relative; 
        }
        
        #globeViz {
            width: 100vw; 
            height: 100vh; 
            position: absolute; 
            top: 0;
            left: 0;
            z-index: 1; 
        }
        
        /* *** æ ¸å¿ƒä¿®æ”¹åŒºåŸŸï¼šæµ®åŠ¨é¢æ¿æ ·å¼å’Œä½ç½® *** */
        .container {
            /* å®šä½åˆ°å³ä¸Šè§’ */
            position: absolute; 
            top: 30px;         /* ç¦»é¡¶éƒ¨ 30px */
            right: 30px;       /* ç¦»å³è¾¹ 30px */
            
            /* æ ·å¼ï¼šé€æ˜ã€ç¼©å°ã€æ— é˜´å½± */
            background: rgba(0, 0, 0, 0.1); /* æè½»å¾®çš„é€æ˜åº•è‰²ï¼Œç”¨äºå¢å¼ºå¯¹æ¯” */
            backdrop-filter: none;          /* ç§»é™¤æ¨¡ç³Šæ•ˆæœ */
            box-shadow: none;               /* ç§»é™¤é˜´å½± */
            padding: 20px 30px;
            border-radius: 10px;
            max-width: 320px; /* ç¼©å°å®½åº¦ */
            width: auto;      /* å®½åº¦è‡ªé€‚åº”å†…å®¹ */
            
            z-index: 10; 
            text-align: center;
            color: #fff; 
            /* å¢åŠ ä¸€ä¸ªè½»å¾®çš„è¾¹æ¡†ï¼Œä»¥é˜²åœ¨äº®è‰²æ˜Ÿçƒä¸Šæ–‡å­—å¯¹æ¯”åº¦ä¸å¤Ÿ */
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        h1 {
            color: #eee;
            margin-bottom: 15px;
            font-size: 1.5em; /* ç¨å¾®ç¼©å° */
            text-shadow: 0 0 5px rgba(0,0,0,0.5); /* å¢åŠ æ–‡å­—é˜´å½±ï¼Œæé«˜åœ¨åœ°çƒä¸Šçš„å¯¹æ¯”åº¦ */
        }
        .intro-text {
            color: #ccc;
            margin-bottom: 20px;
            font-size: 0.9em;
        }
        .result-box {
            margin: 15px 0; /* ç¼©å°å‚ç›´é—´è· */
            min-height: 100px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }
        .city-name {
            font-size: 2.2em; /* ç¨å¾®ç¼©å° */
            font-weight: bold;
            color: #ffda79; /* é‡‘é»„è‰² */
            text-shadow: 1px 1px 3px rgba(0, 0, 0, 1); /* åŠ é‡æ–‡å­—é˜´å½±ï¼Œä¿è¯æµ®åŠ¨æ—¶æ¸…æ™° */
            letter-spacing: 1px;
        }
        .country-name {
            font-size: 1.1em;
            color: #bbb;
            margin-top: 5px;
        }
        .desc {
            margin-top: 15px;
            font-size: 0.85em; /* ç•¥å¾®ç¼©å°æè¿°æ–‡å­— */
            color: #ddd;
            line-height: 1.5;
        }
        button {
            background-color: #3498db;
            color: white;
            border: none;
            padding: 10px 20px;
            font-size: 1em;
            border-radius: 50px;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 5px 10px rgba(0,0,0,0.3); /* è½»å¾®çš„æŒ‰é’®é˜´å½± */
            margin-top: 10px;
        }
        button:hover {
            background-color: #2980b9;
            transform: scale(1.05);
        }

        /* åª’ä½“æŸ¥è¯¢ï¼šé€‚é…å°å±å¹•è®¾å¤‡ï¼Œé¢æ¿æ”¾åœ¨é¡¶éƒ¨ä¸­å¤® */
        @media (max-width: 768px) {
            .container {
                top: 10px;
                right: auto;
                left: 50%;
                transform: translateX(-50%); /* ç§»åŠ¨åˆ°é¡¶éƒ¨ä¸­å¤® */
                max-width: 90%;
            }
        }
    </style>
</head>
<body>

<div id="globeViz"></div>

<div class="container">
    <h1>ğŸŒ ä¸‹ä¸€ç«™ï¼Œè½¬åˆ°å“ªï¼Ÿ</h1>
    <p class="intro-text">ç‚¹å‡»æŒ‰é’®ï¼Œåœ°çƒä»ªå¸¦ä½ é£å‘ä¸‹ä¸€ä¸ªå®‰å…¨ç›®çš„åœ°ï¼</p>
    
    <div class="result-box" id="resultArea">
        <p style="color: #ccc;">å‡†å¤‡å¥½èµ·é£äº†å—ï¼Ÿ</p>
    </div>

    <button onclick="flyToRandomCity()">èµ·é£ï¼å‘Šè¯‰æˆ‘ç­”æ¡ˆ</button>
</div>

<script>
    // --- æ ¸å¿ƒé€»è¾‘ï¼šæ•°æ®è¯»å– (ä¸ä¸Šä¸€æ­¥éª¤ç›¸åŒï¼Œä¿æŒæ•°æ®åˆ†ç¦») ---
    let destinations = []; 
    const resultArea = document.getElementById('resultArea');

    fetch('cities.json')
        .then(response => {
            if (!response.ok) {
                throw new Error('æ•°æ®åŠ è½½å¤±è´¥ï¼Œè¯·æ£€æŸ¥ cities.json æ–‡ä»¶åæ˜¯å¦æ­£ç¡®ï¼');
            }
            return response.json(); 
        })
        .then(data => {
            destinations = data; 
            console.log(`æˆåŠŸåŠ è½½ ${destinations.length} ä¸ªåŸå¸‚æ•°æ®ã€‚`);
        })
        .catch(error => {
            console.error('åŠ è½½æ•°æ®å¤±è´¥:', error);
            resultArea.innerHTML = `<p style="color:red;">å“å‘€ï¼Œæ•°æ®åŠ è½½å¤±è´¥äº†ï¼ ${error.message}</p>`;
        });

    // --- 3D åœ°çƒä»ªåˆå§‹åŒ– ---
    const world = Globe()
      (document.getElementById('globeViz'))
      .globeImageUrl('//unpkg.com/three-globe/example/img/earth-blue-marble.jpg')
      .pointColor(() => '#ffda79') 
      .pointAltitude(0.1)     
      .pointRadius(0.5)
      .backgroundColor('#00000000'); 
      
    world.pointOfView({ altitude: 2.5 });
    world.controls().autoRotate = true;
    world.controls().autoRotateSpeed = 0.5;

    // --- æ ¸å¿ƒåŠŸèƒ½ï¼šç‚¹å‡»æŒ‰é’®é£å‘éšæœºåŸå¸‚ ---
    function flyToRandomCity() {
        if (destinations.length === 0) {
            resultArea.innerHTML = '<p style="color:red;">æ•°æ®è¿˜åœ¨åŠ è½½ä¸­ï¼Œè¯·ç¨ç­‰...</p>';
            return;
        }
        
        resultArea.innerHTML = '<p style="color:#ccc;">æ­£åœ¨è®¡ç®—èˆªçº¿ï¼Œå‡†å¤‡èµ·é£...</p>';
        world.controls().autoRotate = false;

        setTimeout(() => {
            const randomIndex = Math.floor(Math.random() * destinations.length);
            const selected = destinations[randomIndex];

            if (typeof selected.lat === 'undefined' || typeof selected.lng === 'undefined') {
                resultArea.innerHTML = `<p style="color:red;">æ•°æ®é”™è¯¯ï¼šæ‰€é€‰åŸå¸‚ç¼ºå°‘ç»çº¬åº¦åæ ‡ï¼</p>`;
                return;
            }

            world.pointOfView(
                { lat: selected.lat, lng: selected.lng, altitude: 1.5 },
                2500 
            );

            world.pointsData([{lat: selected.lat, lng: selected.lng}]);

            resultArea.innerHTML = `
                <div class="city-name">${selected.city}</div>
                <div class="country-name">${selected.country}</div>
                <div class="desc">${selected.desc}</div>
            `;
        }, 500);
    }

    // é€‚åº”çª—å£å¤§å°å˜åŒ–
    window.addEventListener('resize', () => {
        world.width(window.innerWidth);
        world.height(window.innerHeight); 
    });
    window.dispatchEvent(new Event('resize'));
</script>

</body>
</html>
